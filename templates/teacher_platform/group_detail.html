{% extends 'teacher_platform/base_teacher.html' %}

{% block title %}{{ group.name }}{% endblock %}
{% block page_title %}ğŸ‘¥ {{ group.name }} ({{ group.code }}){% endblock %}

{% block content %}
<div class="page-container">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="{% url 'teacher_platform:groups_list' %}">Grupe</a>
        <span>/</span>
        <span>{{ group.name }}</span>
    </div>

    <!-- Group Overview -->
    <div class="detail-card">
        <div class="detail-header">
            <div>
                <h2>{{ group.name }}</h2>
                <span class="group-code-badge">{{ group.code }}</span>
            </div>
            <div class="header-actions">
                <a href="/admin/teacher_platform/group/{{ group.id }}/change/" class="btn-secondary">EditeazÄƒ GrupÄƒ</a>
                <a href="/admin/teacher_platform/lesson/add/?group={{ group.id }}" class="btn-primary">â• AdaugÄƒ LecÈ›ie</a>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">ğŸ“š Curs:</span>
                <span class="info-value">{{ group.course.title }}</span>
            </div>
            {% if group.module %}
            <div class="info-item">
                <span class="info-label">ğŸ“– Modul:</span>
                <span class="info-value">
                    <span class="module-badge" style="background-color: {{ group.module.color }}20; color: {{ group.module.color }};">
                        {{ group.module.name }}
                    </span>
                </span>
            </div>
            {% endif %}
            {% if group.location %}
            <div class="info-item">
                <span class="info-label">ğŸ“ LocaÈ›ie:</span>
                <span class="info-value">{{ group.location.name }}</span>
            </div>
            {% endif %}
            <div class="info-item">
                <span class="info-label">ğŸ“… Program:</span>
                <span class="info-value">{{ group.get_weekday_display }}, {{ group.start_time|date:"H:i" }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">â±ï¸ DuratÄƒ:</span>
                <span class="info-value">{{ group.duration_minutes }} minute</span>
            </div>
            <div class="info-item">
                <span class="info-label">ğŸ‘¥ StudenÈ›i:</span>
                <span class="info-value">{{ students.count }} / {{ group.max_students }}</span>
            </div>
        </div>

        {% if group.description %}
        <div class="group-description">
            <strong>Descriere:</strong>
            <p>{{ group.description }}</p>
        </div>
        {% endif %}
    </div>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab-btn active" data-tab="students">ğŸ‘¥ StudenÈ›i ({{ students.count }})</button>
        <button class="tab-btn" data-tab="upcoming-lessons">ğŸ“… LecÈ›ii Viitoare ({{ upcoming_lessons.count }})</button>
        <button class="tab-btn" data-tab="past-lessons">ğŸ“š LecÈ›ii Trecute ({{ past_lessons.count }})</button>
        <button class="tab-btn" data-tab="assignments">ğŸ“ Teme ({{ assignments.count }})</button>
        {% if lesson_templates %}
        <button class="tab-btn" data-tab="templates">ğŸ“– È˜abloane LecÈ›ii ({{ lesson_templates.count }})</button>
        {% endif %}
    </div>

    <!-- Tab Content: Students -->
    <div class="tab-content active" id="students">
        {% if students %}
        <div class="students-grid">
            {% for gs in students %}
            <a href="{% url 'teacher_platform:student_detail' gs.student.id %}" class="student-card">
                <div class="student-avatar">
                    {% if gs.student.student_profile %}
                        <span class="avatar-icon">{% if gs.student.student_profile.avatar == 'boy' %}ğŸ‘¦{% else %}ğŸ‘§{% endif %}</span>
                    {% else %}
                        <span class="avatar-icon">ğŸ“</span>
                    {% endif %}
                </div>
                <div class="student-info">
                    <h4>{{ gs.student.get_full_name }}</h4>
                    <div class="student-stats">
                        <span>ğŸ“Š {{ gs.get_attendance_rate }}% prezenÈ›Äƒ</span>
                        <span>ğŸ“š {{ gs.lessons_attended }} lecÈ›ii</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
        <div class="card-footer">
            <a href="/admin/teacher_platform/groupstudent/add/?group={{ group.id }}" class="btn-primary">â• AdaugÄƒ Student Ã®n GrupÄƒ</a>
        </div>
        {% else %}
        <div class="empty-state">
            <p>Nu sunt studenÈ›i Ã®nscriÈ™i Ã®n aceastÄƒ grupÄƒ.</p>
            <a href="/admin/teacher_platform/groupstudent/add/?group={{ group.id }}" class="btn-primary">â• AdaugÄƒ Primul Student</a>
        </div>
        {% endif %}
    </div>

    <!-- Tab Content: Upcoming Lessons -->
    <div class="tab-content" id="upcoming-lessons">
        {% if upcoming_lessons %}
        <div class="lessons-list-detailed">
            {% for lesson in upcoming_lessons %}
            <a href="{% url 'teacher_platform:lesson_detail' lesson.id %}" class="lesson-card-detailed">
                <div class="lesson-date-box">
                    <div class="date-day">{{ lesson.date|date:"d" }}</div>
                    <div class="date-month">{{ lesson.date|date:"M" }}</div>
                    <div class="date-year">{{ lesson.date|date:"Y" }}</div>
                </div>
                <div class="lesson-details">
                    <h4>
                        {% if lesson.lesson_template %}
                            {{ lesson.lesson_template.name }}
                        {% elif lesson.topic %}
                            {{ lesson.topic }}
                        {% else %}
                            LecÈ›ie {{ lesson.date|date:"d M Y" }}
                        {% endif %}
                    </h4>
                    <div class="lesson-meta">
                        <span>ğŸ• {{ lesson.start_time|date:"H:i" }}</span>
                        {% if lesson.end_time %}
                            <span>- {{ lesson.end_time|date:"H:i" }}</span>
                        {% endif %}
                    </div>
                    {% if lesson.description %}
                    <p class="lesson-desc">{{ lesson.description|truncatewords:20 }}</p>
                    {% endif %}
                </div>
                <div class="lesson-status-badge status-{{ lesson.status }}">
                    {{ lesson.get_status_display }}
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p>Nu sunt lecÈ›ii programate pentru viitor.</p>
            <a href="/admin/teacher_platform/lesson/add/?group={{ group.id }}" class="btn-primary">â• ProgrameazÄƒ o LecÈ›ie</a>
        </div>
        {% endif %}
    </div>

    <!-- Tab Content: Past Lessons -->
    <div class="tab-content" id="past-lessons">
        {% if past_lessons %}
        <div class="lessons-list-detailed">
            {% for lesson in past_lessons %}
            <a href="{% url 'teacher_platform:lesson_detail' lesson.id %}" class="lesson-card-detailed">
                <div class="lesson-date-box past">
                    <div class="date-day">{{ lesson.date|date:"d" }}</div>
                    <div class="date-month">{{ lesson.date|date:"M" }}</div>
                </div>
                <div class="lesson-details">
                    <h4>
                        {% if lesson.lesson_template %}
                            {{ lesson.lesson_template.name }}
                        {% elif lesson.topic %}
                            {{ lesson.topic }}
                        {% else %}
                            LecÈ›ie {{ lesson.date|date:"d M Y" }}
                        {% endif %}
                    </h4>
                    <div class="lesson-meta">
                        <span>ğŸ• {{ lesson.start_time|date:"H:i" }}</span>
                    </div>
                </div>
                <div class="lesson-status-badge status-{{ lesson.status }}">
                    {{ lesson.get_status_display }}
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p>Nu sunt lecÈ›ii trecute Ã®nregistrate.</p>
        </div>
        {% endif %}
    </div>

    <!-- Tab Content: Assignments -->
    <div class="tab-content" id="assignments">
        {% if assignments %}
        <div class="assignments-list-detailed">
            {% for assignment in assignments %}
            <a href="{% url 'teacher_platform:assignment_detail' assignment.id %}" class="assignment-card-detailed">
                <div class="assignment-header">
                    <h4>{{ assignment.title }}</h4>
                    <span class="due-date-badge {% if assignment.due_date < today %}overdue{% endif %}">
                        ğŸ“… {{ assignment.due_date|date:"d M Y" }}
                    </span>
                </div>
                <p class="assignment-desc">{{ assignment.description|truncatewords:30 }}</p>
                <div class="assignment-footer">
                    <span>ğŸ“ {{ assignment.submissions.count }} predÄƒri</span>
                    <span>ğŸ’¯ Max: {{ assignment.max_points }} puncte</span>
                </div>
            </a>
            {% endfor %}
        </div>
        <div class="card-footer">
            <a href="/admin/teacher_platform/assignment/add/?group={{ group.id }}" class="btn-primary">â• CreeazÄƒ TemÄƒ NouÄƒ</a>
        </div>
        {% else %}
        <div class="empty-state">
            <p>Nu sunt teme create pentru aceastÄƒ grupÄƒ.</p>
            <a href="/admin/teacher_platform/assignment/add/?group={{ group.id }}" class="btn-primary">â• CreeazÄƒ Prima TemÄƒ</a>
        </div>
        {% endif %}
    </div>

    <!-- Tab Content: Lesson Templates -->
    {% if lesson_templates %}
    <div class="tab-content" id="templates">
        <div class="templates-list">
            {% for template in lesson_templates %}
            <div class="template-card">
                <div class="template-order">{{ template.order }}</div>
                <div class="template-info">
                    <h4>{{ template.name }}</h4>
                    {% if template.description %}
                    <p>{{ template.description|truncatewords:20 }}</p>
                    {% endif %}
                </div>
                <div class="template-actions">
                    {% if template.lesson_plan_file %}
                    <a href="{{ template.lesson_plan_file.url }}" target="_blank" class="btn-secondary">ğŸ“„ Vezi Plan</a>
                    {% endif %}
                    <a href="/admin/teacher_platform/lesson/add/?group={{ group.id }}&lesson_template={{ template.id }}" class="btn-primary">â• ProgrameazÄƒ</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<script>
// Tab switching
document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        // Remove active class from all tabs and contents
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        // Add active class to clicked tab
        btn.classList.add('active');
        const tabId = btn.dataset.tab;
        document.getElementById(tabId).classList.add('active');
    });
});
</script>
{% endblock %}
