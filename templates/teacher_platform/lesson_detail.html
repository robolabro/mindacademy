{% extends 'teacher_platform/base_teacher.html' %}

{% block title %}LecÈ›ie {{ lesson.date|date:"d M Y" }}{% endblock %}
{% block page_title %}ğŸ“š LecÈ›ie - {{ lesson.group.name }}{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="{% url 'teacher_platform:calendar' %}">Calendar</a>
        <span>/</span>
        <a href="{% url 'teacher_platform:group_detail' lesson.group.id %}">{{ lesson.group.name }}</a>
        <span>/</span>
        <span>LecÈ›ie {{ lesson.date|date:"d M Y" }}</span>
    </div>

    <!-- Lesson Overview -->
    <div class="detail-card">
        <div class="detail-header">
            <div>
                <h2>
                    {% if lesson.lesson_template %}
                        {{ lesson.lesson_template.name }}
                    {% elif lesson.topic %}
                        {{ lesson.topic }}
                    {% else %}
                        LecÈ›ie {{ lesson.date|date:"d M Y" }}
                    {% endif %}
                </h2>
                <span class="lesson-status-badge status-{{ lesson.status }}">{{ lesson.get_status_display }}</span>
            </div>
            <div class="header-actions">
                <a href="/admin/teacher_platform/lesson/{{ lesson.id }}/change/" class="btn-secondary">EditeazÄƒ LecÈ›ie</a>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">ğŸ‘¥ GrupÄƒ:</span>
                <span class="info-value">
                    <a href="{% url 'teacher_platform:group_detail' lesson.group.id %}">{{ lesson.group.name }}</a>
                </span>
            </div>
            <div class="info-item">
                <span class="info-label">ğŸ“… Data:</span>
                <span class="info-value">{{ lesson.date|date:"l, d F Y" }}</span>
            </div>
            <div class="info-item">
                <span class="info-label">ğŸ• OrÄƒ:</span>
                <span class="info-value">
                    {{ lesson.start_time|date:"H:i" }}
                    {% if lesson.end_time %} - {{ lesson.end_time|date:"H:i" }}{% endif %}
                </span>
            </div>
            {% if lesson.group.module %}
            <div class="info-item">
                <span class="info-label">ğŸ“– Modul:</span>
                <span class="info-value">
                    <span class="module-badge" style="background-color: {{ lesson.group.module.color }}20; color: {{ lesson.group.module.color }};">
                        {{ lesson.group.module.name }}
                    </span>
                </span>
            </div>
            {% endif %}
        </div>

        {% if lesson.description %}
        <div class="lesson-section">
            <h3>Descriere</h3>
            <p>{{ lesson.description }}</p>
        </div>
        {% endif %}

        {% if lesson.homework %}
        <div class="lesson-section">
            <h3>TemÄƒ pentru AcasÄƒ</h3>
            <p>{{ lesson.homework }}</p>
        </div>
        {% endif %}

        {% if lesson.teacher_notes %}
        <div class="lesson-section">
            <h3>NotiÈ›e Profesor</h3>
            <p>{{ lesson.teacher_notes }}</p>
        </div>
        {% endif %}

        {% if lesson.lesson_template and lesson.lesson_template.lesson_plan_file %}
        <div class="lesson-section">
            <h3>Plan de LecÈ›ie</h3>
            <a href="{{ lesson.lesson_template.lesson_plan_file.url }}" target="_blank" class="btn-secondary">ğŸ“„ Vezi Plan de LecÈ›ie</a>
        </div>
        {% endif %}
    </div>

    <!-- Attendance Tracking -->
    <div class="detail-card">
        <div class="card-header">
            <h2>ğŸ“Š PrezenÈ›Äƒ StudenÈ›i</h2>
            <div class="attendance-summary">
                {% with present_count=students_data|length %}
                <span>StudenÈ›i Ã®n grupÄƒ: {{ present_count }}</span>
                {% endwith %}
            </div>
        </div>

        <div class="card-body">
            {% if students_data %}
            <div class="attendance-table">
                <table>
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>PrezenÈ›Äƒ</th>
                            <th>PerformanÈ›Äƒ</th>
                            <th>ObservaÈ›ii</th>
                            <th>AcÈ›iuni</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for data in students_data %}
                        <tr>
                            <td>
                                <a href="{% url 'teacher_platform:student_detail' data.student.id %}" class="student-link">
                                    {{ data.student.get_full_name }}
                                </a>
                            </td>
                            <td>
                                {% if data.attendance %}
                                    {% if data.attendance.is_present %}
                                        <span class="status-badge status-present">âœ“ Prezent</span>
                                    {% else %}
                                        <span class="status-badge status-absent">âœ— Absent</span>
                                    {% endif %}
                                {% else %}
                                    <span class="status-badge status-pending">âŠ Nemarcat</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if data.attendance and data.attendance.performance_rating %}
                                    <div class="performance-stars">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= data.attendance.performance_rating %}â­{% else %}â˜†{% endif %}
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if data.attendance and data.attendance.notes %}
                                    <span class="notes-preview">{{ data.attendance.notes|truncatewords:10 }}</span>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if data.attendance %}
                                    <a href="/admin/teacher_platform/attendance/{{ data.attendance.id }}/change/" class="btn-small">EditeazÄƒ</a>
                                {% else %}
                                    <a href="/admin/teacher_platform/attendance/add/?lesson={{ lesson.id }}&student={{ data.student.id }}" class="btn-small btn-primary-small">MarcheazÄƒ</a>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <p>Nu sunt studenÈ›i Ã®nscriÈ™i Ã®n aceastÄƒ grupÄƒ.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
