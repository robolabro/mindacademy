{% extends 'teacher_platform/base_teacher.html' %}

{% block title %}{{ title }}{% endblock %}
{% block page_title %}{{ title }}{% endblock %}

{% block content %}
<div class="page-container">
    <div class="form-container">
        <div class="form-card">
            <form method="post" id="groupForm">
                {% csrf_token %}

                {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
                {% endif %}

                <div class="form-section">
                    <h3>üìã Informa»õii Generale</h3>

                    <div class="form-group">
                        <label for="{{ form.name.id_for_label }}">{{ form.name.label }} *</label>
                        {{ form.name }}
                        {% if form.name.errors %}
                        <div class="error-message">{{ form.name.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.course.id_for_label }}">{{ form.course.label }} *</label>
                            {{ form.course }}
                            {% if form.course.errors %}
                            <div class="error-message">{{ form.course.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.module.id_for_label }}">{{ form.module.label }}</label>
                            {{ form.module }}
                            {% if form.module.errors %}
                            <div class="error-message">{{ form.module.errors.0 }}</div>
                            {% endif %}
                            <small class="form-text">SelecteazƒÉ mai √Ænt√¢i un curs</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="{{ form.location.id_for_label }}">{{ form.location.label }}</label>
                        {{ form.location }}
                        {% if form.location.errors %}
                        <div class="error-message">{{ form.location.errors.0 }}</div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
                        {{ form.description }}
                        {% if form.description.errors %}
                        <div class="error-message">{{ form.description.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-section">
                    <h3>üìÖ Program</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.weekday.id_for_label }}">{{ form.weekday.label }} *</label>
                            {{ form.weekday }}
                            {% if form.weekday.errors %}
                            <div class="error-message">{{ form.weekday.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.start_time.id_for_label }}">{{ form.start_time.label }} *</label>
                            {{ form.start_time }}
                            {% if form.start_time.errors %}
                            <div class="error-message">{{ form.start_time.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.duration_minutes.id_for_label }}">{{ form.duration_minutes.label }} *</label>
                            {{ form.duration_minutes }}
                            {% if form.duration_minutes.errors %}
                            <div class="error-message">{{ form.duration_minutes.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="{{ form.start_date.id_for_label }}">{{ form.start_date.label }} *</label>
                            {{ form.start_date }}
                            {% if form.start_date.errors %}
                            <div class="error-message">{{ form.start_date.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="form-group">
                            <label for="{{ form.end_date.id_for_label }}">{{ form.end_date.label }}</label>
                            {{ form.end_date }}
                            {% if form.end_date.errors %}
                            <div class="error-message">{{ form.end_date.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="{{ form.max_occurrences.id_for_label }}">{{ form.max_occurrences.label }}</label>
                        {{ form.max_occurrences }}
                        {% if form.max_occurrences.errors %}
                        <div class="error-message">{{ form.max_occurrences.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text">{{ form.max_occurrences.help_text }}</small>
                    </div>
                </div>

                <div class="form-section">
                    <h3>üë• SetƒÉri Elevi</h3>

                    <div class="form-group">
                        <label for="{{ form.max_students.id_for_label }}">{{ form.max_students.label }} *</label>
                        {{ form.max_students }}
                        {% if form.max_students.errors %}
                        <div class="error-message">{{ form.max_students.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="form-section">
                    <h3>üìÜ Data Creare</h3>

                    <div class="form-group">
                        <label for="{{ form.created_date.id_for_label }}">{{ form.created_date.label }} *</label>
                        {{ form.created_date }}
                        {% if form.created_date.errors %}
                        <div class="error-message">{{ form.created_date.errors.0 }}</div>
                        {% endif %}
                        <small class="form-text">{{ form.created_date.help_text }}</small>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">üíæ SalveazƒÉ</button>
                    <a href="{% url 'teacher_platform:groups_list' %}" class="btn-secondary">‚ùå AnuleazƒÉ</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const courseSelect = document.getElementById('id_course');
    const moduleSelect = document.getElementById('id_module');

    if (courseSelect && moduleSelect) {
        courseSelect.addEventListener('change', function() {
            const courseId = this.value;

            if (courseId) {
                // Fetch modules for the selected course
                fetch(`{% url 'teacher_platform:get_modules_for_course' %}?course_id=${courseId}`)
                    .then(response => response.json())
                    .then(data => {
                        // Clear current options
                        moduleSelect.innerHTML = '<option value="">---------</option>';

                        // Add new options
                        data.forEach(module => {
                            const option = document.createElement('option');
                            option.value = module.id;
                            option.textContent = module.title;
                            moduleSelect.appendChild(option);
                        });

                        moduleSelect.disabled = false;
                    })
                    .catch(error => {
                        console.error('Error fetching modules:', error);
                    });
            } else {
                moduleSelect.innerHTML = '<option value="">---------</option>';
                moduleSelect.disabled = true;
            }
        });

        // If course is already selected on page load, trigger change
        if (courseSelect.value) {
            courseSelect.dispatchEvent(new Event('change'));
        }
    }
});
</script>

<style>
.form-container {
    max-width: 900px;
    margin: 0 auto;
}

.form-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 30px;
}

.form-section {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #e0e0e0;
}

.form-section:last-of-type {
    border-bottom: none;
}

.form-section h3 {
    margin-bottom: 20px;
    color: #333;
    font-size: 18px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #333;
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.form-control, .form-select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
}

.form-control:focus, .form-select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
}

.form-text {
    display: block;
    margin-top: 5px;
    font-size: 12px;
    color: #666;
}

.error-message {
    color: #dc3545;
    font-size: 13px;
    margin-top: 5px;
}

.alert {
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 20px;
}

.alert-danger {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.form-actions {
    display: flex;
    gap: 10px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #e0e0e0;
}

.btn-primary, .btn-secondary {
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

.btn-primary:hover {
    opacity: 0.9;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}
</style>
{% endblock %}
