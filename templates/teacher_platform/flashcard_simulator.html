{% extends 'teacher_platform/base_teacher.html' %}

{% block title %}Simulator Cartona»ôe Flash{% endblock %}
{% block page_title %}Cartona»ôe Flash{% endblock %}

{% block extra_css %}
<style>
    .flashcard-container {
        padding: 2rem;
        max-width: 100%;
        min-height: calc(100vh - 180px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    }

    /* Mode Selection Screen */
    .mode-selection {
        background: white;
        border-radius: 20px;
        padding: 2.5rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        max-width: 900px;
        width: 95%;
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .mode-title {
        text-align: center;
        font-size: 2rem;
        color: var(--text-primary);
        margin-bottom: 2.5rem;
        font-weight: 600;
    }

    .mode-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1rem;
    }

    .mode-card {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 15px;
        padding: 2rem 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        min-height: 160px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .mode-card:hover {
        border-color: var(--primary-color);
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
    }

    .mode-card-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .mode-card-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .mode-card-desc {
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.4;
    }

    /* Common Styles for All Modes */
    .mode-screen {
        display: none;
        background: white;
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        max-width: 1200px;
        width: 95%;
        min-height: 600px;
    }

    .mode-screen.active {
        display: flex;
        flex-direction: column;
    }

    .mode-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f0f0f0;
    }

    .mode-header h2 {
        font-size: 1.8rem;
        color: var(--text-primary);
        font-weight: 600;
    }

    .back-btn {
        padding: 0.6rem 1.5rem;
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .back-btn:hover {
        background: #5a6268;
        transform: translateY(-2px);
    }

    .settings-panel {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .settings-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .settings-row:last-child {
        margin-bottom: 0;
    }

    .setting-label {
        font-size: 1rem;
        font-weight: 500;
        color: var(--text-primary);
        min-width: 150px;
    }

    .setting-controls {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .number-input {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .number-btn {
        width: 35px;
        height: 35px;
        border: none;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .number-btn:hover {
        background: var(--secondary-color);
        transform: scale(1.1);
    }

    .number-display {
        min-width: 60px;
        max-width: 80px;
        text-align: center;
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-primary);
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 0.3rem 0.5rem;
        background: white;
        transition: border-color 0.3s ease;
    }

    .number-display:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .number-display::-webkit-inner-spin-button,
    .number-display::-webkit-outer-spin-button {
        opacity: 1;
    }

    .toggle-group {
        display: flex;
        gap: 0.5rem;
    }

    .toggle-btn {
        padding: 0.5rem 1.2rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        background: white;
        color: var(--text-primary);
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .toggle-btn:hover {
        border-color: var(--primary-color);
    }

    .toggle-btn.active {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        border-color: var(--primary-color);
    }

    .start-btn {
        padding: 0.8rem 2.5rem;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-top: 1rem;
        align-self: center;
    }

    .start-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(245, 87, 108, 0.3);
    }

    .instructions-panel {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 2rem;
    }

    .instructions-panel h3 {
        color: #856404;
        margin-bottom: 1rem;
        font-size: 1.2rem;
    }

    .instructions-panel p {
        color: #856404;
        line-height: 1.6;
        margin-bottom: 0.5rem;
    }

    .instructions-panel ul {
        color: #856404;
        margin-left: 1.5rem;
        line-height: 1.8;
    }

    /* Exercise Area */
    .exercise-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        background: #f8f9fa;
        border-radius: 15px;
        min-height: 400px;
    }

    .countdown {
        font-size: 6rem;
        font-weight: 700;
        color: var(--primary-color);
        animation: pulse 0.5s ease;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .mini-abacus {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        width: 100%;
        display: flex;
        justify-content: center;
    }

    .abacus-frame-mini {
        display: inline-flex;
        gap: 2.5rem;
        padding: 2.5rem 3.5rem;
        background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
        border-radius: 20px;
        border: 8px solid #654321;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .rod-mini {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        position: relative;
    }

    .rod-line-mini {
        width: 8px;
        height: 240px;
        background: linear-gradient(to bottom, #4a2511 0%, #654321 50%, #4a2511 100%);
        position: relative;
        display: flex;
        flex-direction: column;
        border-radius: 4px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    }

    .divider-mini {
        position: absolute;
        top: 25%;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 6px;
        background: linear-gradient(to right, #2c2c2c 0%, #1a1a1a 50%, #2c2c2c 100%);
        border-radius: 3px;
        z-index: 5;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
    }

    /* Marker dot on units column (rightmost rod, index 0) */
    .rod-mini:last-child .divider-mini::after {
        content: '';
        position: absolute;
        width: 10px;
        height: 10px;
        background: radial-gradient(circle, #ff4444 0%, #cc0000 100%);
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 2px 4px rgba(255, 68, 68, 0.6), 0 0 8px rgba(255, 68, 68, 0.4);
        z-index: 6;
    }

    .beads-section-mini {
        position: absolute;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .beads-section-mini.top {
        top: 0;
        padding-top: 8px;
    }

    .beads-section-mini.bottom {
        bottom: 0;
        padding-bottom: 8px;
    }

    .bead-mini {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        position: relative;
        transition: all 0.35s cubic-bezier(0.4, 0.0, 0.2, 1);
        cursor: pointer;
        margin: 4px 0;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    }

    /* Top beads (heaven - value 5) */
    .bead-mini.top {
        /* Inactive state - at top edge, muted color */
        background: linear-gradient(135deg, #b8c5d6 0%, #8fa3bc 100%);
        box-shadow:
            0 4px 10px rgba(0, 0, 0, 0.3),
            inset -2px -2px 4px rgba(0, 0, 0, 0.2),
            inset 2px 2px 4px rgba(255, 255, 255, 0.4);
    }

    .bead-mini.top.active {
        /* Active state - touching separator, vibrant color */
        background: linear-gradient(135deg, #4ecdc4 0%, #2baea5 100%);
        transform: translateY(50px);
        box-shadow:
            0 6px 14px rgba(46, 204, 196, 0.5),
            inset -2px -2px 4px rgba(0, 0, 0, 0.2),
            inset 2px 2px 4px rgba(255, 255, 255, 0.5);
    }

    .bead-mini.top:hover {
        filter: brightness(1.1);
        transform: scale(1.05);
    }

    .bead-mini.top.active:hover {
        filter: brightness(1.1);
        transform: translateY(50px) scale(1.05);
    }

    /* Bottom beads (earth - value 1 each) */
    .bead-mini.bottom {
        /* Inactive state - at bottom edge, muted color */
        background: linear-gradient(135deg, #b8c5d6 0%, #8fa3bc 100%);
        box-shadow:
            0 4px 10px rgba(0, 0, 0, 0.3),
            inset -2px -2px 4px rgba(0, 0, 0, 0.2),
            inset 2px 2px 4px rgba(255, 255, 255, 0.4);
    }

    .bead-mini.bottom.active {
        /* Active state - touching separator, vibrant color */
        background: linear-gradient(135deg, #f6c23e 0%, #e6a609 100%);
        transform: translateY(-48px);
        box-shadow:
            0 6px 14px rgba(246, 194, 62, 0.5),
            inset -2px -2px 4px rgba(0, 0, 0, 0.2),
            inset 2px 2px 4px rgba(255, 255, 255, 0.5);
    }

    .bead-mini.bottom:hover {
        filter: brightness(1.1);
        transform: scale(1.05);
    }

    .bead-mini.bottom.active:hover {
        filter: brightness(1.1);
        transform: translateY(-48px) scale(1.05);
    }

    .answer-input {
        width: 400px;
        padding: 1.2rem;
        font-size: 2.5rem;
        text-align: center;
        border: 3px solid #e0e0e0;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
    }

    .answer-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .submit-btn {
        padding: 1rem 3rem;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.3rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .submit-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
    }

    .feedback {
        font-size: 1.5rem;
        font-weight: 600;
        padding: 1rem 2rem;
        border-radius: 10px;
        margin-top: 1rem;
    }

    .feedback.correct {
        background: #d4edda;
        color: #155724;
    }

    .feedback.incorrect {
        background: #f8d7da;
        color: #721c24;
    }

    .stats {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 1rem;
        font-size: 1.1rem;
    }

    .stat-item {
        padding: 0.5rem 1rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .stat-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .stat-value {
        color: var(--text-primary);
        font-weight: 600;
        font-size: 1.3rem;
    }

    /* Classwork Mode */
    .classwork-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .classwork-controls {
        display: flex;
        gap: 1rem;
    }

    .control-btn {
        padding: 0.7rem 1.5rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .settings-btn {
        background: #6c757d;
        color: white;
    }

    .settings-btn:hover {
        background: #5a6268;
    }

    .start-all-btn {
        background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
        color: white;
    }

    .start-all-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 176, 155, 0.3);
    }

    .results-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .results-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    .students-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        height: 600px;
    }

    .student-panel {
        background: #f8f9fa;
        border: 2px solid #dee2e6;
        border-radius: 15px;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
    }

    .student-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #dee2e6;
        gap: 0.5rem;
    }

    .student-name-input {
        padding: 0.5rem;
        font-size: 1rem;
        border: 1px solid #ced4da;
        border-radius: 5px;
        flex: 1;
        max-width: 150px;
    }

    .student-header-buttons {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .student-status {
        display: none;
        width: 30px;
        height: 30px;
        border-radius: 5px;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .student-status.show {
        display: flex;
    }

    .student-status.correct {
        background: #d4edda;
        color: #155724;
    }

    .student-status.incorrect {
        background: #f8d7da;
        color: #721c24;
    }

    .student-settings-btn {
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 0.4rem 0.8rem;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s ease;
    }

    .student-settings-btn:hover {
        background: #5a6268;
    }

    .delete-student-btn {
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 0.4rem 0.8rem;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .delete-student-btn:hover {
        background: #c82333;
    }

    .student-exercise {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    /* Modal for Settings */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 20px;
        padding: 2rem;
        max-width: 800px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f0f0f0;
    }

    .modal-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .close-modal {
        background: none;
        border: none;
        font-size: 2rem;
        color: var(--text-secondary);
        cursor: pointer;
        line-height: 1;
    }

    .close-modal:hover {
        color: var(--text-primary);
    }

    /* Feedback Modal */
    .feedback-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        align-items: center;
        justify-content: center;
    }

    .feedback-modal.active {
        display: flex;
    }

    .feedback-modal-content {
        background: white;
        border-radius: 20px;
        padding: 3rem;
        max-width: 400px;
        width: 90%;
        text-align: center;
        animation: slideIn 0.3s ease;
    }

    .feedback-modal-title {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
    }

    .feedback-modal-title.correct {
        color: #155724;
    }

    .feedback-modal-title.incorrect {
        color: #721c24;
    }

    .feedback-modal-btn {
        padding: 0.8rem 2rem;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .feedback-modal-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
    }

    .not-solved-text {
        font-size: 1.2rem;
        color: var(--text-secondary);
        text-align: center;
        padding: 2rem;
    }

    .answer-btn {
        padding: 0.8rem 2rem;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1.2rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .answer-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(245, 87, 108, 0.3);
    }

    .your-answer-label {
        font-size: 1rem;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        font-weight: 500;
    }

    .answer-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        padding: 1rem;
    }

    .answer-area .answer-input {
        width: 100%;
        max-width: 350px;
        padding: 1rem;
        font-size: 1.5rem;
        text-align: center;
        border: 3px solid #e0e0e0;
        border-radius: 10px;
    }

    .answer-area .answer-input:focus {
        outline: none;
        border-color: var(--primary-color);
    }

    /* Responsive */
    @media (max-width: 768px) {
        .mode-grid {
            grid-template-columns: 1fr;
        }

        .students-grid {
            grid-template-columns: 1fr;
            height: auto;
        }

        .settings-row {
            flex-direction: column;
            align-items: flex-start;
        }

        .answer-input {
            width: 100%;
            max-width: 300px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="flashcard-container">
    <!-- Mode Selection Screen -->
    <div id="modeSelection" class="mode-selection">
        <h1 class="mode-title">Alege Modul de Lucru</h1>
        <div class="mode-grid">
            <div class="mode-card" onclick="selectMode('training')">
                <div class="mode-card-icon">üìö</div>
                <div class="mode-card-title">Mod Antrenament</div>
                <div class="mode-card-desc">√énva»õƒÉ sƒÉ recuno»ôti numerele pe soroban</div>
            </div>
            <div class="mode-card" onclick="selectMode('flash')">
                <div class="mode-card-icon">‚ö°</div>
                <div class="mode-card-title">Mod Flash</div>
                <div class="mode-card-desc">Exerci»õiu de vitezƒÉ pentru recunoa»ôtere rapidƒÉ</div>
            </div>
            <div class="mode-card" onclick="selectMode('exercises')">
                <div class="mode-card-icon">üßÆ</div>
                <div class="mode-card-title">Exerci»õii</div>
                <div class="mode-card-desc">RezolvƒÉ probleme de matematicƒÉ cu soroban</div>
            </div>
            <div class="mode-card" onclick="selectMode('classwork')">
                <div class="mode-card-icon">üë•</div>
                <div class="mode-card-title">Lucru √Æn ClasƒÉ</div>
                <div class="mode-card-desc">PracticƒÉ √ÆmpreunƒÉ cu 4 elevi simultan</div>
            </div>
        </div>
    </div>

    <!-- Training Mode -->
    <div id="trainingMode" class="mode-screen">
        <div class="mode-header">
            <h2>Mod Antrenament</h2>
            <button class="back-btn" onclick="backToModes()">‚Üê √énapoi</button>
        </div>

        <div class="instructions-panel">
            <h3>Instruc»õiuni</h3>
            <p>Modul de antrenament te ajutƒÉ sƒÉ √Ænve»õi sƒÉ percepi numerele exprimate pe un soroban.</p>
            <p>√én etapa ini»õialƒÉ, este necesar sƒÉ te obi»ônuie»ôti cu numerele reprezentate pe soroban.</p>
            <ul>
                <li><strong>Soroban ‚Üí NumƒÉr:</strong> Va apƒÉrea un numƒÉr pe ecran pe care trebuie sƒÉ √Æl introduci</li>
                <li><strong>NumƒÉr ‚Üí Soroban:</strong> Va apƒÉrea un numƒÉr pe care trebuie sƒÉ √Æl setezi pe soroban</li>
            </ul>
        </div>

        <div class="settings-panel">
            <div class="settings-row">
                <span class="setting-label">Direc»õie:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-direction="abacus-to-number">Soroban ‚Üí NumƒÉr</button>
                        <button class="toggle-btn" data-direction="number-to-abacus">NumƒÉr ‚Üí Soroban</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">De la:</span>
                <div class="setting-controls">
                    <div class="number-input">
                        <button class="number-btn" onclick="adjustNumber('trainingFrom', -1)">‚àí</button>
                        <input type="number" class="number-display" id="trainingFrom" value="1" min="1" max="999" onchange="updateSettingFromInput('trainingFrom', 'training', 'from')">
                        <button class="number-btn" onclick="adjustNumber('trainingFrom', 1)">+</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">P√¢nƒÉ la:</span>
                <div class="setting-controls">
                    <div class="number-input">
                        <button class="number-btn" onclick="adjustNumber('trainingTo', -1)">‚àí</button>
                        <input type="number" class="number-display" id="trainingTo" value="99" min="1" max="999" onchange="updateSettingFromInput('trainingTo', 'training', 'to')">
                        <button class="number-btn" onclick="adjustNumber('trainingTo', 1)">+</button>
                    </div>
                </div>
            </div>

        </div>

        <button class="start-btn" onclick="startTraining()">Start!</button>

        <div id="trainingExercise" class="exercise-area" style="display: none;">
            <div id="trainingContent"></div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">Corecte</div>
                    <div class="stat-value" id="trainingCorrect">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Gre»ôite</div>
                    <div class="stat-value" id="trainingIncorrect">0</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Flash Mode -->
    <div id="flashMode" class="mode-screen">
        <div class="mode-header">
            <h2>Mod Flash</h2>
            <button class="back-btn" onclick="backToModes()">‚Üê √énapoi</button>
        </div>

        <div class="instructions-panel">
            <h3>Instruc»õiuni</h3>
            <p>Modul "Flash" este un exerci»õiu de vitezƒÉ!</p>
            <ul>
                <li><strong>Soroban ‚Üí NumƒÉr:</strong> Va apƒÉrea o imagine a unui soroban pe care trebuie sƒÉ scrii numerele</li>
                <li><strong>NumƒÉr ‚Üí Soroban:</strong> Va apƒÉrea un numƒÉr pe care trebuie sƒÉ √Æl scrii</li>
            </ul>
            <p>Op»õiunea "spune rƒÉspunsul" este pentru lucrul √Æn clasƒÉ. √én acest caz, trebuie sƒÉ scrii rƒÉspunsurile pentru a le verifica la sf√¢r»ôitul sesiunii.</p>
        </div>

        <div class="settings-panel">
            <div class="settings-row">
                <span class="setting-label">Direc»õie:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-direction="abacus-to-number">Soroban ‚Üí NumƒÉr</button>
                        <button class="toggle-btn" data-direction="number-to-abacus">NumƒÉr ‚Üí Soroban</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">De la:</span>
                <div class="setting-controls">
                    <div class="number-input">
                        <button class="number-btn" onclick="adjustNumber('flashFrom', -1)">‚àí</button>
                        <input type="number" class="number-display" id="flashFrom" value="1" min="1" max="999" onchange="updateSettingFromInput('flashFrom', 'flash', 'from')">
                        <button class="number-btn" onclick="adjustNumber('flashFrom', 1)">+</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">P√¢nƒÉ la:</span>
                <div class="setting-controls">
                    <div class="number-input">
                        <button class="number-btn" onclick="adjustNumber('flashTo', -1)">‚àí</button>
                        <input type="number" class="number-display" id="flashTo" value="99" min="1" max="999" onchange="updateSettingFromInput('flashTo', 'flash', 'to')">
                        <button class="number-btn" onclick="adjustNumber('flashTo', 1)">+</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">VitezƒÉ (sec.):</span>
                <div class="setting-controls">
                    <div class="number-input">
                        <button class="number-btn" onclick="adjustSpeed(-0.1)">‚àí</button>
                        <span class="number-display" id="flashSpeed">1.0</span>
                        <button class="number-btn" onclick="adjustSpeed(0.1)">+</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">FormƒÉ de rƒÉspuns:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-response="enter">Introdu rƒÉspunsul</button>
                        <button class="toggle-btn" data-response="say">Spune rƒÉspunsul</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">Durata seriei:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn" data-duration="one-minute">Un minut</button>
                        <button class="toggle-btn active" data-duration="unlimited">Nelimitat</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">Mod simplu:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-simple="ordinary">Obi»ônuit</button>
                        <button class="toggle-btn" data-simple="simple">Mod simplu</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">Sunete:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-sound="signals">Semnale</button>
                        <button class="toggle-btn" data-sound="no-sound">FƒÉrƒÉ sunet</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">Efecte:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-effects="on">Activate</button>
                        <button class="toggle-btn" data-effects="off">Dezactivate</button>
                    </div>
                </div>
            </div>
        </div>

        <button class="start-btn" onclick="startFlash()">Start!</button>

        <div id="flashExercise" class="exercise-area" style="display: none;">
            <div id="flashContent"></div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">Corecte</div>
                    <div class="stat-value" id="flashCorrect">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Gre»ôite</div>
                    <div class="stat-value" id="flashIncorrect">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Timp rƒÉmas</div>
                    <div class="stat-value" id="flashTimer">--</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Exercises Mode -->
    <div id="exercisesMode" class="mode-screen">
        <div class="mode-header">
            <h2>Exerci»õii</h2>
            <button class="back-btn" onclick="backToModes()">‚Üê √énapoi</button>
        </div>

        <div class="instructions-panel">
            <h3>Instruc»õiuni</h3>
            <p>Hai sƒÉ √ÆncercƒÉm sƒÉ rezolvƒÉm probleme matematice cu cartona»ôe flash?</p>
            <p>Exemplele vor apƒÉrea pe ecran compuse din doi termeni, afi»ôa»õi pe soroban.</p>
            <p>Alege formula »ôi mƒÉrimea termenilor care ar trebui inclu»ôi √Æn exemple. Po»õi introduce rƒÉspunsul tast√¢nd un numƒÉr sau folosind sorobanul.</p>
        </div>

        <div class="settings-panel">
            <div class="settings-row">
                <span class="setting-label">Formula:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-formula="addition">Adunare</button>
                        <button class="toggle-btn" data-formula="subtraction">ScƒÉdere</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">Sec»õiune:</span>
                <div class="setting-controls">
                    <div class="toggle-group" id="sectionButtons">
                        <button class="toggle-btn active" data-section="1">1</button>
                        <button class="toggle-btn" data-section="2">2</button>
                        <button class="toggle-btn" data-section="3">3</button>
                        <button class="toggle-btn" data-section="4">4</button>
                        <button class="toggle-btn" data-section="5">5</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">Termeni:</span>
                <div class="setting-controls">
                    <div class="number-input">
                        <button class="number-btn" onclick="adjustNumber('exerciseAddends', -1)">‚àí</button>
                        <input type="number" class="number-display" id="exerciseAddends" value="2" min="2" max="5" onchange="updateSettingFromInput('exerciseAddends', 'exercises', 'addends')">
                        <button class="number-btn" onclick="adjustNumber('exerciseAddends', 1)">+</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">RƒÉspuns prin:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-answer="number">NumƒÉr</button>
                        <button class="toggle-btn" data-answer="abacus">Pe soroban</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">Mod simplu:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-simple="ordinary">Obi»ônuit</button>
                        <button class="toggle-btn" data-simple="simple">Mod simplu</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">Sunete:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-sound="signals">Semnale</button>
                        <button class="toggle-btn" data-sound="no-sound">FƒÉrƒÉ sunet</button>
                    </div>
                </div>
            </div>

            <div class="settings-row">
                <span class="setting-label">Efecte:</span>
                <div class="setting-controls">
                    <div class="toggle-group">
                        <button class="toggle-btn active" data-effects="on">Activate</button>
                        <button class="toggle-btn" data-effects="off">Dezactivate</button>
                    </div>
                </div>
            </div>
        </div>

        <button class="start-btn" onclick="startExercises()">Start!</button>

        <div id="exercisesArea" class="exercise-area" style="display: none;">
            <div id="exercisesContent"></div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">Corecte</div>
                    <div class="stat-value" id="exercisesCorrect">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Gre»ôite</div>
                    <div class="stat-value" id="exercisesIncorrect">0</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Classwork Mode -->
    <div id="classworkMode" class="mode-screen">
        <div class="classwork-header">
            <h2>Lucru √Æn ClasƒÉ</h2>
            <div class="classwork-controls">
                <button class="control-btn settings-btn" onclick="openClassworkSettings()">‚öôÔ∏è SetƒÉri</button>
                <button class="control-btn start-all-btn" onclick="startAllStudents()">‚ñ∂Ô∏è Start</button>
                <button class="control-btn results-btn" onclick="showResults()">üìä Rezultate</button>
                <button class="back-btn" onclick="backToModes()">‚Üê √énapoi</button>
            </div>
        </div>

        <div class="students-grid" id="studentsGrid">
            <div class="student-panel" data-student-id="1">
                <div class="student-header">
                    <input type="text" class="student-name-input" value="–£—á–µ–Ω–∏–∫ 1" placeholder="Nume elev">
                    <div class="student-header-buttons">
                        <div class="student-status"></div>
                        <button class="student-settings-btn" onclick="openStudentSettings(1)">‚öôÔ∏è</button>
                        <button class="delete-student-btn" onclick="removeStudent(this)">‚úï</button>
                    </div>
                </div>
                <div class="student-exercise">
                    <div class="mini-abacus" style="display: none;">
                        <div class="abacus-frame-mini" data-student="1"></div>
                    </div>
                    <div class="not-solved-text" style="display: none;">The example is not solved</div>
                    <div style="display: none;" class="answer-area">
                        <div class="your-answer-label">Your answer:</div>
                        <input type="text" class="answer-input" placeholder="RƒÉspuns">
                        <button class="answer-btn" onclick="checkStudentAnswer(1)">Answer</button>
                    </div>
                    <div class="countdown" style="display: none;"></div>
                </div>
            </div>

            <div class="student-panel" data-student-id="2">
                <div class="student-header">
                    <input type="text" class="student-name-input" value="–£—á–µ–Ω–∏–∫ 2" placeholder="Nume elev">
                    <div class="student-header-buttons">
                        <div class="student-status"></div>
                        <button class="student-settings-btn" onclick="openStudentSettings(2)">‚öôÔ∏è</button>
                        <button class="delete-student-btn" onclick="removeStudent(this)">‚úï</button>
                    </div>
                </div>
                <div class="student-exercise">
                    <div class="mini-abacus" style="display: none;">
                        <div class="abacus-frame-mini" data-student="2"></div>
                    </div>
                    <div class="not-solved-text" style="display: none;">The example is not solved</div>
                    <div style="display: none;" class="answer-area">
                        <div class="your-answer-label">Your answer:</div>
                        <input type="text" class="answer-input" placeholder="RƒÉspuns">
                        <button class="answer-btn" onclick="checkStudentAnswer(2)">Answer</button>
                    </div>
                    <div class="countdown" style="display: none;"></div>
                </div>
            </div>

            <div class="student-panel" data-student-id="3">
                <div class="student-header">
                    <input type="text" class="student-name-input" value="–£—á–µ–Ω–∏–∫ 3" placeholder="Nume elev">
                    <div class="student-header-buttons">
                        <div class="student-status"></div>
                        <button class="student-settings-btn" onclick="openStudentSettings(3)">‚öôÔ∏è</button>
                        <button class="delete-student-btn" onclick="removeStudent(this)">‚úï</button>
                    </div>
                </div>
                <div class="student-exercise">
                    <div class="mini-abacus" style="display: none;">
                        <div class="abacus-frame-mini" data-student="3"></div>
                    </div>
                    <div class="not-solved-text" style="display: none;">The example is not solved</div>
                    <div style="display: none;" class="answer-area">
                        <div class="your-answer-label">Your answer:</div>
                        <input type="text" class="answer-input" placeholder="RƒÉspuns">
                        <button class="answer-btn" onclick="checkStudentAnswer(3)">Answer</button>
                    </div>
                    <div class="countdown" style="display: none;"></div>
                </div>
            </div>

            <div class="student-panel" data-student-id="4">
                <div class="student-header">
                    <input type="text" class="student-name-input" value="–£—á–µ–Ω–∏–∫ 4" placeholder="Nume elev">
                    <div class="student-header-buttons">
                        <div class="student-status"></div>
                        <button class="student-settings-btn" onclick="openStudentSettings(4)">‚öôÔ∏è</button>
                        <button class="delete-student-btn" onclick="removeStudent(this)">‚úï</button>
                    </div>
                </div>
                <div class="student-exercise">
                    <div class="mini-abacus" style="display: none;">
                        <div class="abacus-frame-mini" data-student="4"></div>
                    </div>
                    <div class="not-solved-text" style="display: none;">The example is not solved</div>
                    <div style="display: none;" class="answer-area">
                        <div class="your-answer-label">Your answer:</div>
                        <input type="text" class="answer-input" placeholder="RƒÉspuns">
                        <button class="answer-btn" onclick="checkStudentAnswer(4)">Answer</button>
                    </div>
                    <div class="countdown" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Classwork Settings Modal -->
    <div id="classworkSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">SetƒÉri Lucru √Æn ClasƒÉ</h3>
                <button class="close-modal" onclick="closeClassworkSettings()">√ó</button>
            </div>

            <div class="settings-panel">
                <div class="settings-row">
                    <span class="setting-label">Direc»õie:</span>
                    <div class="setting-controls">
                        <div class="toggle-group">
                            <button class="toggle-btn active" data-direction="abacus-to-number">Soroban ‚Üí NumƒÉr</button>
                            <button class="toggle-btn" data-direction="number-to-abacus">NumƒÉr ‚Üí Soroban</button>
                        </div>
                    </div>
                </div>

                <div class="settings-row">
                    <span class="setting-label">De la:</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustNumber('classworkFrom', -1)">‚àí</button>
                            <input type="number" class="number-display" id="classworkFrom" value="1" min="1" max="999" onchange="updateSettingFromInput('classworkFrom', 'classwork', 'from')">
                            <button class="number-btn" onclick="adjustNumber('classworkFrom', 1)">+</button>
                        </div>
                    </div>
                </div>

                <div class="settings-row">
                    <span class="setting-label">P√¢nƒÉ la:</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustNumber('classworkTo', -1)">‚àí</button>
                            <input type="number" class="number-display" id="classworkTo" value="99" min="1" max="999" onchange="updateSettingFromInput('classworkTo', 'classwork', 'to')">
                            <button class="number-btn" onclick="adjustNumber('classworkTo', 1)">+</button>
                        </div>
                    </div>
                </div>

                <div class="settings-row">
                    <span class="setting-label">Timp afi»ôare (sec.):</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustDisplayTime(-0.1)">‚àí</button>
                            <span class="number-display" id="classworkDisplayTime">1.0</span>
                            <button class="number-btn" onclick="adjustDisplayTime(0.1)">+</button>
                        </div>
                    </div>
                </div>

                <div class="settings-row">
                    <span class="setting-label">Mod simplu:</span>
                    <div class="setting-controls">
                        <div class="toggle-group">
                            <button class="toggle-btn active" data-simple="ordinary">Obi»ônuit</button>
                            <button class="toggle-btn" data-simple="simple">Mod simplu</button>
                        </div>
                    </div>
                </div>
            </div>

            <button class="start-btn" onclick="closeClassworkSettings()">SalveazƒÉ</button>
        </div>
    </div>

    <!-- Individual Student Settings Modals -->
    <div id="studentSettingsModal1" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–£—á–µ–Ω–∏–∫ 1</h3>
                <button class="close-modal" onclick="closeStudentSettings(1)">√ó</button>
            </div>
            <div class="settings-panel">
                <div class="settings-row">
                    <span class="setting-label">Direction</span>
                    <div class="setting-controls">
                        <div class="toggle-group">
                            <button class="toggle-btn" data-student="1" data-setting="direction" data-value="abacus-to-number">Abacus</button>
                            <button class="toggle-btn active" data-student="1" data-setting="direction" data-value="number-to-abacus">Number</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">From</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentNumber(1, 'from', -1)">‚àí</button>
                            <span class="number-display" id="student1From">1</span>
                            <button class="number-btn" onclick="adjustStudentNumber(1, 'from', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">To</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentNumber(1, 'to', -1)">‚àí</button>
                            <span class="number-display" id="student1To">99</span>
                            <button class="number-btn" onclick="adjustStudentNumber(1, 'to', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">Speed (sec.)</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentSpeed(1, -0.1)">‚àí</button>
                            <span class="number-display" id="student1Speed">1</span>
                            <button class="number-btn" onclick="adjustStudentSpeed(1, 0.1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">Simple mode</span>
                    <div class="setting-controls">
                        <div class="toggle-group">
                            <button class="toggle-btn active" data-student="1" data-setting="simple" data-value="ordinary">Ordinary</button>
                            <button class="toggle-btn" data-student="1" data-setting="simple" data-value="simple">Simple mode</button>
                        </div>
                    </div>
                </div>
            </div>
            <button class="start-btn" onclick="closeStudentSettings(1)">Save</button>
        </div>
    </div>

    <div id="studentSettingsModal2" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–£—á–µ–Ω–∏–∫ 2</h3>
                <button class="close-modal" onclick="closeStudentSettings(2)">√ó</button>
            </div>
            <div class="settings-panel">
                <div class="settings-row">
                    <span class="setting-label">Direction</span>
                    <div class="setting-controls">
                        <div class="toggle-group">
                            <button class="toggle-btn" data-student="2" data-setting="direction" data-value="abacus-to-number">Abacus</button>
                            <button class="toggle-btn active" data-student="2" data-setting="direction" data-value="number-to-abacus">Number</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">From</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentNumber(2, 'from', -1)">‚àí</button>
                            <span class="number-display" id="student2From">1</span>
                            <button class="number-btn" onclick="adjustStudentNumber(2, 'from', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">To</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentNumber(2, 'to', -1)">‚àí</button>
                            <span class="number-display" id="student2To">99</span>
                            <button class="number-btn" onclick="adjustStudentNumber(2, 'to', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">Speed (sec.)</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentSpeed(2, -0.1)">‚àí</button>
                            <span class="number-display" id="student2Speed">1</span>
                            <button class="number-btn" onclick="adjustStudentSpeed(2, 0.1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">Simple mode</span>
                    <div class="setting-controls">
                        <div class="toggle-group">
                            <button class="toggle-btn active" data-student="2" data-setting="simple" data-value="ordinary">Ordinary</button>
                            <button class="toggle-btn" data-student="2" data-setting="simple" data-value="simple">Simple mode</button>
                        </div>
                    </div>
                </div>
            </div>
            <button class="start-btn" onclick="closeStudentSettings(2)">Save</button>
        </div>
    </div>

    <div id="studentSettingsModal3" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–£—á–µ–Ω–∏–∫ 3</h3>
                <button class="close-modal" onclick="closeStudentSettings(3)">√ó</button>
            </div>
            <div class="settings-panel">
                <div class="settings-row">
                    <span class="setting-label">Direction</span>
                    <div class="setting-controls">
                        <div class="toggle-group">
                            <button class="toggle-btn" data-student="3" data-setting="direction" data-value="abacus-to-number">Abacus</button>
                            <button class="toggle-btn active" data-student="3" data-setting="direction" data-value="number-to-abacus">Number</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">From</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentNumber(3, 'from', -1)">‚àí</button>
                            <span class="number-display" id="student3From">1</span>
                            <button class="number-btn" onclick="adjustStudentNumber(3, 'from', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">To</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentNumber(3, 'to', -1)">‚àí</button>
                            <span class="number-display" id="student3To">99</span>
                            <button class="number-btn" onclick="adjustStudentNumber(3, 'to', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">Speed (sec.)</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentSpeed(3, -0.1)">‚àí</button>
                            <span class="number-display" id="student3Speed">1</span>
                            <button class="number-btn" onclick="adjustStudentSpeed(3, 0.1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">Simple mode</span>
                    <div class="setting-controls">
                        <div class="toggle-group">
                            <button class="toggle-btn active" data-student="3" data-setting="simple" data-value="ordinary">Ordinary</button>
                            <button class="toggle-btn" data-student="3" data-setting="simple" data-value="simple">Simple mode</button>
                        </div>
                    </div>
                </div>
            </div>
            <button class="start-btn" onclick="closeStudentSettings(3)">Save</button>
        </div>
    </div>

    <div id="studentSettingsModal4" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–£—á–µ–Ω–∏–∫ 4</h3>
                <button class="close-modal" onclick="closeStudentSettings(4)">√ó</button>
            </div>
            <div class="settings-panel">
                <div class="settings-row">
                    <span class="setting-label">Direction</span>
                    <div class="setting-controls">
                        <div class="toggle-group">
                            <button class="toggle-btn" data-student="4" data-setting="direction" data-value="abacus-to-number">Abacus</button>
                            <button class="toggle-btn active" data-student="4" data-setting="direction" data-value="number-to-abacus">Number</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">From</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentNumber(4, 'from', -1)">‚àí</button>
                            <span class="number-display" id="student4From">1</span>
                            <button class="number-btn" onclick="adjustStudentNumber(4, 'from', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">To</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentNumber(4, 'to', -1)">‚àí</button>
                            <span class="number-display" id="student4To">99</span>
                            <button class="number-btn" onclick="adjustStudentNumber(4, 'to', 1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">Speed (sec.)</span>
                    <div class="setting-controls">
                        <div class="number-input">
                            <button class="number-btn" onclick="adjustStudentSpeed(4, -0.1)">‚àí</button>
                            <span class="number-display" id="student4Speed">1</span>
                            <button class="number-btn" onclick="adjustStudentSpeed(4, 0.1)">+</button>
                        </div>
                    </div>
                </div>
                <div class="settings-row">
                    <span class="setting-label">Simple mode</span>
                    <div class="setting-controls">
                        <div class="toggle-group">
                            <button class="toggle-btn active" data-student="4" data-setting="simple" data-value="ordinary">Ordinary</button>
                            <button class="toggle-btn" data-student="4" data-setting="simple" data-value="simple">Simple mode</button>
                        </div>
                    </div>
                </div>
            </div>
            <button class="start-btn" onclick="closeStudentSettings(4)">Save</button>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="feedback-modal">
        <div class="feedback-modal-content">
            <h2 class="feedback-modal-title" id="feedbackTitle">Correct answer</h2>
            <button class="feedback-modal-btn" onclick="closeFeedbackModal()">Continue ‚Üí</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Global state
    let currentMode = null;
    let currentSettings = {
        training: {
            direction: 'abacus-to-number',
            from: 1,
            to: 99
        },
        flash: {
            direction: 'abacus-to-number',
            from: 1,
            to: 99,
            speed: 1.0,
            response: 'enter',
            duration: 'unlimited',
            simple: 'ordinary',
            sound: 'signals',
            effects: 'on'
        },
        exercises: {
            formula: 'addition',
            section: 1,
            addends: 2,
            answer: 'number',
            simple: 'ordinary',
            sound: 'signals',
            effects: 'on'
        },
        classwork: {
            direction: 'abacus-to-number',
            from: 1,
            to: 99,
            displayTime: 1.0,
            simple: 'ordinary'
        },
        students: {
            1: { direction: 'number-to-abacus', from: 1, to: 99, speed: 1.0, simple: 'ordinary' },
            2: { direction: 'number-to-abacus', from: 1, to: 99, speed: 1.0, simple: 'ordinary' },
            3: { direction: 'number-to-abacus', from: 1, to: 99, speed: 1.0, simple: 'ordinary' },
            4: { direction: 'number-to-abacus', from: 1, to: 99, speed: 1.0, simple: 'ordinary' }
        }
    };

    let stats = {
        correct: 0,
        incorrect: 0
    };

    let currentNumber = 0;
    let exerciseTimer = null;
    let flashTimer = null;

    // Student-specific data
    let studentNumbers = {
        1: 0,
        2: 0,
        3: 0,
        4: 0
    };

    let studentResults = {
        1: null,
        2: null,
        3: null,
        4: null
    };

    // Mode selection
    function selectMode(mode) {
        document.getElementById('modeSelection').style.display = 'none';

        if (mode === 'training') {
            document.getElementById('trainingMode').classList.add('active');
            currentMode = 'training';
        } else if (mode === 'flash') {
            document.getElementById('flashMode').classList.add('active');
            currentMode = 'flash';
        } else if (mode === 'exercises') {
            document.getElementById('exercisesMode').classList.add('active');
            currentMode = 'exercises';
        } else if (mode === 'classwork') {
            document.getElementById('classworkMode').classList.add('active');
            currentMode = 'classwork';
        }
    }

    function backToModes() {
        // Hide all mode screens
        document.querySelectorAll('.mode-screen').forEach(screen => {
            screen.classList.remove('active');
        });

        // Reset exercise areas
        document.getElementById('trainingExercise').style.display = 'none';
        document.getElementById('flashExercise').style.display = 'none';
        document.getElementById('exercisesArea').style.display = 'none';

        // Reset stats
        stats.correct = 0;
        stats.incorrect = 0;

        // Clear timers
        if (exerciseTimer) clearInterval(exerciseTimer);
        if (flashTimer) clearInterval(flashTimer);

        // Show mode selection
        document.getElementById('modeSelection').style.display = 'block';
        currentMode = null;
    }

    // Number adjustment
    function adjustNumber(elementId, delta) {
        const element = document.getElementById(elementId);
        let currentValue = parseInt(element.value || element.textContent);
        let newValue = currentValue + delta;

        // Set boundaries based on element
        if (elementId.includes('From')) {
            newValue = Math.max(1, Math.min(999, newValue));
        } else if (elementId.includes('To')) {
            newValue = Math.max(1, Math.min(999, newValue));
        } else if (elementId.includes('Addends')) {
            newValue = Math.max(2, Math.min(5, newValue));
        }

        // Update element value (works for both input and span)
        if (element.tagName === 'INPUT') {
            element.value = newValue;
        } else {
            element.textContent = newValue;
        }

        // Update settings
        if (elementId.startsWith('training')) {
            if (elementId.includes('From')) currentSettings.training.from = newValue;
            if (elementId.includes('To')) currentSettings.training.to = newValue;
        } else if (elementId.startsWith('flash')) {
            if (elementId.includes('From')) currentSettings.flash.from = newValue;
            if (elementId.includes('To')) currentSettings.flash.to = newValue;
        } else if (elementId.startsWith('exercise')) {
            if (elementId.includes('Addends')) currentSettings.exercises.addends = newValue;
        } else if (elementId.startsWith('classwork')) {
            if (elementId.includes('From')) currentSettings.classwork.from = newValue;
            if (elementId.includes('To')) currentSettings.classwork.to = newValue;
        }
    }

    // Update setting from direct input
    function updateSettingFromInput(elementId, mode, field) {
        const element = document.getElementById(elementId);
        let value = parseInt(element.value);

        // Validate and constrain
        if (field === 'from' || field === 'to') {
            value = Math.max(1, Math.min(999, value));
        } else if (field === 'addends') {
            value = Math.max(2, Math.min(5, value));
        }

        // Update element with validated value
        element.value = value;

        // Update settings
        if (currentSettings[mode]) {
            currentSettings[mode][field] = value;
        }
    }

    function adjustSpeed(delta) {
        const element = document.getElementById('flashSpeed');
        let currentValue = parseFloat(element.textContent);
        let newValue = Math.max(0.1, Math.min(3.0, currentValue + delta));
        element.textContent = newValue.toFixed(1);
        currentSettings.flash.speed = newValue;
    }

    function adjustDisplayTime(delta) {
        const element = document.getElementById('classworkDisplayTime');
        let currentValue = parseFloat(element.textContent);
        let newValue = Math.max(0.1, Math.min(3.0, currentValue + delta));
        element.textContent = newValue.toFixed(1);
        currentSettings.classwork.displayTime = newValue;
    }

    // Toggle button handlers
    document.querySelectorAll('.toggle-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const group = this.parentElement;
            group.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');

            // Update settings based on data attributes
            const dataKeys = Object.keys(this.dataset);
            dataKeys.forEach(key => {
                const mode = this.closest('.mode-screen').id.replace('Mode', '');
                if (currentSettings[mode]) {
                    currentSettings[mode][key] = this.dataset[key];
                }
            });
        });
    });

    // Generate random number in range
    function getRandomNumber(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // Create mini abacus representation
    function createMiniAbacus(number, container) {
        container.innerHTML = '';
        const digits = String(number).padStart(2, '0').split('').reverse();

        digits.forEach((digit, index) => {
            const rod = document.createElement('div');
            rod.className = 'rod-mini';

            const rodLine = document.createElement('div');
            rodLine.className = 'rod-line-mini';

            // Top section (heaven beads - value 5)
            const topSection = document.createElement('div');
            topSection.className = 'beads-section-mini top';

            const topBead = document.createElement('div');
            topBead.className = 'bead-mini top';
            const digitValue = parseInt(digit);
            if (digitValue >= 5) {
                topBead.classList.add('active');
            }
            topSection.appendChild(topBead);
            rodLine.appendChild(topSection);

            // Divider
            const divider = document.createElement('div');
            divider.className = 'divider-mini';
            rodLine.appendChild(divider);

            // Bottom section (earth beads - value 1 each)
            const bottomSection = document.createElement('div');
            bottomSection.className = 'beads-section-mini bottom';

            const bottomValue = digitValue % 5;
            for (let i = 1; i <= 4; i++) {
                const bottomBead = document.createElement('div');
                bottomBead.className = `bead-mini bottom b${i}`;
                if (i <= bottomValue) {
                    bottomBead.classList.add('active');
                }
                bottomSection.appendChild(bottomBead);
            }
            rodLine.appendChild(bottomSection);

            rod.appendChild(rodLine);
            container.appendChild(rod);
        });
    }

    // Training Mode
    function startTraining() {
        stats.correct = 0;
        stats.incorrect = 0;
        document.getElementById('trainingCorrect').textContent = '0';
        document.getElementById('trainingIncorrect').textContent = '0';
        document.getElementById('trainingExercise').style.display = 'flex';
        nextTrainingExercise();
    }

    function nextTrainingExercise() {
        const { from, to, direction } = currentSettings.training;
        currentNumber = getRandomNumber(from, to);
        const content = document.getElementById('trainingContent');
        content.innerHTML = '';

        if (direction === 'abacus-to-number') {
            // Show abacus, ask for number
            const abacusDiv = document.createElement('div');
            abacusDiv.className = 'mini-abacus';
            const frame = document.createElement('div');
            frame.className = 'abacus-frame-mini';
            abacusDiv.appendChild(frame);
            createMiniAbacus(currentNumber, frame);

            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'answer-input';
            input.placeholder = 'Introdu numƒÉrul';
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkTrainingAnswer(parseInt(this.value));
                }
            });

            const submitBtn = document.createElement('button');
            submitBtn.className = 'submit-btn';
            submitBtn.textContent = 'VerificƒÉ';
            submitBtn.onclick = () => checkTrainingAnswer(parseInt(input.value));

            content.appendChild(abacusDiv);
            content.appendChild(input);
            content.appendChild(submitBtn);

            setTimeout(() => input.focus(), 100);
        } else {
            // Show number, ask to set on abacus
            const numberDiv = document.createElement('div');
            numberDiv.style.fontSize = '3rem';
            numberDiv.style.fontWeight = '700';
            numberDiv.style.marginBottom = '2rem';
            numberDiv.textContent = currentNumber;

            const abacusDiv = document.createElement('div');
            abacusDiv.className = 'mini-abacus';
            const frame = document.createElement('div');
            frame.className = 'abacus-frame-mini';
            abacusDiv.appendChild(frame);
            createMiniAbacus(0, frame);
            makeAbacusInteractive(frame);

            const submitBtn = document.createElement('button');
            submitBtn.className = 'submit-btn';
            submitBtn.textContent = 'VerificƒÉ';
            submitBtn.onclick = () => checkTrainingAbacus(frame);

            content.appendChild(numberDiv);
            content.appendChild(abacusDiv);
            content.appendChild(submitBtn);
        }
    }

    function checkTrainingAnswer(answer) {
        const feedback = document.createElement('div');
        feedback.className = 'feedback';

        if (answer === currentNumber) {
            feedback.classList.add('correct');
            feedback.textContent = '‚úì Corect!';
            stats.correct++;
            document.getElementById('trainingCorrect').textContent = stats.correct;
        } else {
            feedback.classList.add('incorrect');
            feedback.textContent = `‚úó Gre»ôit! RƒÉspunsul corect: ${currentNumber}`;
            stats.incorrect++;
            document.getElementById('trainingIncorrect').textContent = stats.incorrect;
        }

        const content = document.getElementById('trainingContent');
        content.appendChild(feedback);

        setTimeout(() => {
            nextTrainingExercise();
        }, 2000);
    }

    function makeAbacusInteractive(frame) {
        const rods = frame.querySelectorAll('.rod-mini');
        rods.forEach((rod, rodIndex) => {
            // Handle top bead (heaven - value 5)
            const topBead = rod.querySelector('.bead-mini.top');
            if (topBead) {
                topBead.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
            }

            // Handle bottom beads (earth - value 1 each)
            const bottomBeads = Array.from(rod.querySelectorAll('.bead-mini.bottom'));
            bottomBeads.forEach((bead, beadIndex) => {
                bead.addEventListener('click', function() {
                    const isActive = this.classList.contains('active');

                    if (!isActive) {
                        // LIFTING BEADS (activating) - lift clicked bead and all above it
                        let beadsToActivate = beadIndex + 1; // Number of beads to activate from top
                        for (let i = 0; i < beadsToActivate; i++) {
                            bottomBeads[i].classList.add('active');
                        }
                    } else {
                        // LOWERING BEADS (deactivating) - lower clicked bead and all beads below it
                        for (let i = beadIndex; i < bottomBeads.length; i++) {
                            bottomBeads[i].classList.remove('active');
                        }
                    }
                });
            });
        });
    }

    function checkTrainingAbacus(frame) {
        const rods = frame.querySelectorAll('.rod-mini');
        let abacusNumber = 0;

        rods.forEach((rod, index) => {
            let digitValue = 0;

            // Check top bead (heaven - value 5)
            const topBead = rod.querySelector('.bead-mini.top');
            if (topBead && topBead.classList.contains('active')) {
                digitValue += 5;
            }

            // Check bottom beads (earth - value 1 each)
            const bottomBeads = rod.querySelectorAll('.bead-mini.bottom.active');
            digitValue += bottomBeads.length;

            abacusNumber += digitValue * Math.pow(10, index);
        });

        checkTrainingAnswer(abacusNumber);
    }

    // Flash Mode
    function startFlash() {
        stats.correct = 0;
        stats.incorrect = 0;
        document.getElementById('flashCorrect').textContent = '0';
        document.getElementById('flashIncorrect').textContent = '0';
        document.getElementById('flashExercise').style.display = 'flex';

        if (currentSettings.flash.duration === 'one-minute') {
            let timeLeft = 60;
            document.getElementById('flashTimer').textContent = timeLeft;
            flashTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('flashTimer').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(flashTimer);
                    alert(`Sesiune terminatƒÉ! Corecte: ${stats.correct}, Gre»ôite: ${stats.incorrect}`);
                    backToModes();
                }
            }, 1000);
        } else {
            document.getElementById('flashTimer').textContent = '‚àû';
        }

        nextFlashExercise();
    }

    function nextFlashExercise() {
        const { from, to, direction, speed, response } = currentSettings.flash;
        currentNumber = getRandomNumber(from, to);
        const content = document.getElementById('flashContent');
        content.innerHTML = '';

        if (direction === 'abacus-to-number') {
            const abacusDiv = document.createElement('div');
            abacusDiv.className = 'mini-abacus';
            const frame = document.createElement('div');
            frame.className = 'abacus-frame-mini';
            abacusDiv.appendChild(frame);
            createMiniAbacus(currentNumber, frame);

            content.appendChild(abacusDiv);

            setTimeout(() => {
                abacusDiv.style.display = 'none';

                if (response === 'enter') {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.className = 'answer-input';
                    input.placeholder = 'Introdu numƒÉrul';
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            checkFlashAnswer(parseInt(this.value));
                        }
                    });

                    const submitBtn = document.createElement('button');
                    submitBtn.className = 'submit-btn';
                    submitBtn.textContent = 'VerificƒÉ';
                    submitBtn.onclick = () => checkFlashAnswer(parseInt(input.value));

                    content.appendChild(input);
                    content.appendChild(submitBtn);
                    input.focus();
                } else {
                    // Say answer mode - just show next button
                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'submit-btn';
                    nextBtn.textContent = 'UrmƒÉtorul';
                    nextBtn.onclick = () => nextFlashExercise();
                    content.appendChild(nextBtn);
                }
            }, speed * 1000);
        }
    }

    function checkFlashAnswer(answer) {
        const content = document.getElementById('flashContent');
        const feedback = document.createElement('div');
        feedback.className = 'feedback';

        if (answer === currentNumber) {
            feedback.classList.add('correct');
            feedback.textContent = '‚úì Corect!';
            stats.correct++;
            document.getElementById('flashCorrect').textContent = stats.correct;
        } else {
            feedback.classList.add('incorrect');
            feedback.textContent = `‚úó Gre»ôit! RƒÉspunsul corect: ${currentNumber}`;
            stats.incorrect++;
            document.getElementById('flashIncorrect').textContent = stats.incorrect;
        }

        content.appendChild(feedback);

        setTimeout(() => {
            nextFlashExercise();
        }, 1500);
    }

    // Exercises Mode
    function startExercises() {
        stats.correct = 0;
        stats.incorrect = 0;
        document.getElementById('exercisesCorrect').textContent = '0';
        document.getElementById('exercisesIncorrect').textContent = '0';
        document.getElementById('exercisesArea').style.display = 'flex';
        nextExercise();
    }

    function nextExercise() {
        const { formula, section, addends } = currentSettings.exercises;
        const content = document.getElementById('exercisesContent');
        content.innerHTML = '';

        // Generate random numbers based on section
        const maxDigits = section;
        const maxNum = Math.pow(10, maxDigits) - 1;
        const numbers = [];

        for (let i = 0; i < addends; i++) {
            numbers.push(getRandomNumber(1, maxNum));
        }

        // Calculate correct answer
        let correctAnswer;
        if (formula === 'addition') {
            correctAnswer = numbers.reduce((a, b) => a + b, 0);
        } else {
            correctAnswer = numbers[0] - numbers.slice(1).reduce((a, b) => a + b, 0);
        }

        // Display problem
        const problemDiv = document.createElement('div');
        problemDiv.style.fontSize = '2rem';
        problemDiv.style.marginBottom = '2rem';
        problemDiv.style.textAlign = 'center';

        numbers.forEach((num, index) => {
            const abacusDiv = document.createElement('div');
            abacusDiv.style.display = 'inline-block';
            abacusDiv.style.margin = '0 1rem';
            const frame = document.createElement('div');
            frame.className = 'abacus-frame-mini';
            abacusDiv.appendChild(frame);
            createMiniAbacus(num, frame);
            problemDiv.appendChild(abacusDiv);

            if (index < numbers.length - 1) {
                const operator = document.createElement('span');
                operator.textContent = formula === 'addition' ? ' + ' : ' - ';
                operator.style.fontSize = '2rem';
                operator.style.margin = '0 1rem';
                problemDiv.appendChild(operator);
            }
        });

        const input = document.createElement('input');
        input.type = 'number';
        input.className = 'answer-input';
        input.placeholder = 'Introdu rƒÉspunsul';
        input.dataset.correctAnswer = correctAnswer;
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkExerciseAnswer(parseInt(this.value), parseInt(this.dataset.correctAnswer));
            }
        });

        const submitBtn = document.createElement('button');
        submitBtn.className = 'submit-btn';
        submitBtn.textContent = 'VerificƒÉ';
        submitBtn.onclick = () => checkExerciseAnswer(parseInt(input.value), correctAnswer);

        content.appendChild(problemDiv);
        content.appendChild(input);
        content.appendChild(submitBtn);

        setTimeout(() => input.focus(), 100);
    }

    function checkExerciseAnswer(answer, correctAnswer) {
        const content = document.getElementById('exercisesContent');
        const feedback = document.createElement('div');
        feedback.className = 'feedback';

        if (answer === correctAnswer) {
            feedback.classList.add('correct');
            feedback.textContent = '‚úì Corect!';
            stats.correct++;
            document.getElementById('exercisesCorrect').textContent = stats.correct;
        } else {
            feedback.classList.add('incorrect');
            feedback.textContent = `‚úó Gre»ôit! RƒÉspunsul corect: ${correctAnswer}`;
            stats.incorrect++;
            document.getElementById('exercisesIncorrect').textContent = stats.incorrect;
        }

        content.appendChild(feedback);

        setTimeout(() => {
            nextExercise();
        }, 2000);
    }

    // Classwork Mode
    function openClassworkSettings() {
        document.getElementById('classworkSettingsModal').classList.add('active');
    }

    function closeClassworkSettings() {
        document.getElementById('classworkSettingsModal').classList.remove('active');
    }

    function openStudentSettings(studentId) {
        document.getElementById(`studentSettingsModal${studentId}`).classList.add('active');

        // Set up toggle button handlers for this modal
        const modal = document.getElementById(`studentSettingsModal${studentId}`);
        modal.querySelectorAll('.toggle-btn[data-student]').forEach(btn => {
            btn.addEventListener('click', function() {
                const group = this.parentElement;
                group.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const setting = this.dataset.setting;
                const value = this.dataset.value;
                currentSettings.students[studentId][setting] = value;
            });
        });
    }

    function closeStudentSettings(studentId) {
        document.getElementById(`studentSettingsModal${studentId}`).classList.remove('active');
    }

    function adjustStudentNumber(studentId, field, delta) {
        const element = document.getElementById(`student${studentId}${field.charAt(0).toUpperCase() + field.slice(1)}`);
        let currentValue = parseInt(element.textContent);
        let newValue = currentValue + delta;

        if (field === 'from') {
            newValue = Math.max(0, Math.min(999, newValue));
        } else if (field === 'to') {
            newValue = Math.max(1, Math.min(999, newValue));
        }

        element.textContent = newValue;
        currentSettings.students[studentId][field] = newValue;
    }

    function adjustStudentSpeed(studentId, delta) {
        const element = document.getElementById(`student${studentId}Speed`);
        let currentValue = parseFloat(element.textContent);
        let newValue = Math.max(0.1, Math.min(3.0, currentValue + delta));
        element.textContent = newValue.toFixed(0);
        currentSettings.students[studentId].speed = newValue;
    }

    function startAllStudents() {
        const panels = document.querySelectorAll('.student-panel');

        // Reset all student states
        panels.forEach(panel => {
            const studentId = parseInt(panel.dataset.studentId);
            studentResults[studentId] = null;
            const statusDiv = panel.querySelector('.student-status');
            statusDiv.classList.remove('show', 'correct', 'incorrect');
            panel.querySelector('.not-solved-text').style.display = 'none';
            panel.querySelector('.answer-area').style.display = 'none';
            panel.querySelector('.mini-abacus').style.display = 'none';
        });

        // Show countdown 3, 2, 1
        panels.forEach(panel => {
            const countdown = panel.querySelector('.countdown');
            countdown.style.display = 'block';
        });

        let count = 3;
        const countdownInterval = setInterval(() => {
            panels.forEach(panel => {
                const countdown = panel.querySelector('.countdown');
                countdown.textContent = count;
            });

            count--;

            if (count < 0) {
                clearInterval(countdownInterval);
                showStudentExercise();
            }
        }, 1000);
    }

    function showStudentExercise() {
        const panels = document.querySelectorAll('.student-panel');

        panels.forEach(panel => {
            const studentId = parseInt(panel.dataset.studentId);
            const settings = currentSettings.students[studentId];

            const countdown = panel.querySelector('.countdown');
            countdown.style.display = 'none';

            const number = getRandomNumber(settings.from, settings.to);
            studentNumbers[studentId] = number;

            const abacusContainer = panel.querySelector('.abacus-frame-mini');
            const abacusDiv = panel.querySelector('.mini-abacus');
            const answerArea = panel.querySelector('.answer-area');
            const notSolvedText = panel.querySelector('.not-solved-text');

            if (settings.direction === 'abacus-to-number') {
                createMiniAbacus(number, abacusContainer);
                abacusDiv.style.display = 'block';

                setTimeout(() => {
                    abacusDiv.style.display = 'none';
                    notSolvedText.style.display = 'block';
                    answerArea.style.display = 'flex';
                }, settings.speed * 1000);
            } else {
                // Number to abacus - show number then ask to set abacus
                notSolvedText.textContent = `Set this number on abacus: ${number}`;
                notSolvedText.style.display = 'block';
                answerArea.style.display = 'flex';
            }
        });
    }

    function checkStudentAnswer(studentId) {
        const panel = document.querySelector(`.student-panel[data-student-id="${studentId}"]`);
        const input = panel.querySelector('.answer-input');
        const userAnswer = parseInt(input.value);
        const correctAnswer = studentNumbers[studentId];
        const isCorrect = userAnswer === correctAnswer;

        studentResults[studentId] = isCorrect;

        // Update status indicator
        const statusDiv = panel.querySelector('.student-status');
        statusDiv.classList.add('show');
        statusDiv.classList.remove('correct', 'incorrect');
        statusDiv.classList.add(isCorrect ? 'correct' : 'incorrect');
        statusDiv.textContent = isCorrect ? '‚úì' : '‚úó';

        // Show feedback modal
        const feedbackModal = document.getElementById('feedbackModal');
        const feedbackTitle = document.getElementById('feedbackTitle');
        feedbackTitle.className = 'feedback-modal-title';
        feedbackTitle.classList.add(isCorrect ? 'correct' : 'incorrect');
        feedbackTitle.textContent = isCorrect ? 'Correct answer' : 'Incorrect answer';
        feedbackModal.classList.add('active');

        // Hide exercise area
        panel.querySelector('.answer-area').style.display = 'none';
        panel.querySelector('.not-solved-text').style.display = 'none';

        // Clear input for next round
        input.value = '';
    }

    function closeFeedbackModal() {
        document.getElementById('feedbackModal').classList.remove('active');
    }

    function showResults() {
        const panels = document.querySelectorAll('.student-panel');
        let results = 'Rezultate:\n\n';

        panels.forEach((panel, index) => {
            const studentId = parseInt(panel.dataset.studentId);
            const name = panel.querySelector('.student-name-input').value;
            const result = studentResults[studentId];

            let status = 'Not answered';
            if (result === true) status = '‚úì Correct';
            else if (result === false) status = `‚úó Incorrect (Correct: ${studentNumbers[studentId]})`;

            results += `${name}: ${status}\n`;
        });

        alert(results);
    }

    function removeStudent(btn) {
        // Placeholder - in a full implementation this would remove the panel
        alert('Func»õionalitatea de eliminare a elevilor va fi implementatƒÉ');
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Flashcard Simulator Initialized');
    });
</script>
{% endblock %}
